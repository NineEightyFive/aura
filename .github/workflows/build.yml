name: Build AURA Installers

on:
  push:
    tags:
      - 'v*'

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Temurin JDK 21
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 21

      - name: Build JAR
        run: mvn -B package --file pom.xml

      - name: Build Windows EXE with jpackage
        run: >
          jpackage
          --name "AURA"
          --input target
          --main-jar EchoMaster.jar
          --main-class AuraMain.Main
          --type exe
          --icon src/main/resources/img/appicon.ico
          --win-dir-chooser
          --win-shortcut
          --win-menu
          --jvm-args "--enable-preview"

      - name: Upload EXE to Release
        uses: softprops/action-gh-release@v1
        with:
          files: AURA-1.0.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  build-macos:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Temurin JDK 21
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 21

      - name: Build JAR
        run: mvn -B package --file pom.xml

      - name: Build macOS DMG with jpackage
        run: >
          jpackage
          --name "AURA"
          --input target
          --main-jar EchoMaster.jar
          --main-class AuraMain.Main
          --type dmg
          --icon src/main/resources/img/appicon.icns
          --java-options "--enable-preview"

      - name: Upload DMG to Release
        uses: softprops/action-gh-release@v1
        with:
          files: AURA-1.0.dmg
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}